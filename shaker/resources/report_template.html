<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

  <title>Shaker | The Report</title>

  <!-- LIBS -->

  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/select2/3.5.2/select2.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/sammy.js/0.7.6/sammy.min.js"></script>

  <!-- STYLES -->

  <link rel="stylesheet"
        href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.4/simplex/bootstrap.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <link rel=stylesheet type=text/css
        href="http://cdn.jsdelivr.net/select2/3.4.5/select2.css">
  <link rel=stylesheet type=text/css
        href="http://cdnjs.cloudflare.com/ajax/libs/select2/3.4.8/select2-bootstrap.css">
  <link rel=stylesheet type=text/css
        href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.css">
  <link rel='stylesheet' type='text/css'
        href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic&subset=latin,cyrillic'>

  <script type="application/javascript">
    var report = {
  "records": [
    {
      "status": "ok",
      "node": null,
      "concurrency": 1,
      "scenario": "scenarios/misc/static_agent.yaml",
      "stdout": "total 24\ndrwxrwxr-x 3 ishakhat ishakhat 4096 Apr  8 15:45 .\ndrwxrwxr-x 7 ishakhat ishakhat 4096 Apr  8 15:30 ..\n-rw-rw-r-- 1 ishakhat ishakhat 3635 Apr  8 15:30 agent.py\n-rw-rw-r-- 1 ishakhat ishakhat 3581 Apr  8 15:45 agent.pyc\n-rw-rw-r-- 1 ishakhat ishakhat    0 Mar 19 16:59 __init__.py\n-rw-rw-r-- 1 ishakhat ishakhat  138 Mar 23 14:04 __init__.pyc\ndrwxrwxr-x 2 ishakhat ishakhat 4096 Apr  8 16:10 __pycache__\n",
      "command": {
        "data": "ls -al",
        "type": "program"
      },
      "agent_id": "the-agent",
      "stderr": "",
      "executor": "shell",
      "test": "List all files"
    },
    {
      "status": "ok",
      "node": null,
      "concurrency": 1,
      "scenario": "scenarios/misc/static_agent.yaml",
      "stdout": "hello\nworld\n",
      "command": {
        "data": "#!/bin/bash\necho \"hello\"\necho \"world\"\n",
        "type": "script"
      },
      "agent_id": "the-agent",
      "stderr": "",
      "executor": "shell",
      "test": "Run sample script"
    }
  ],
  "agents": {
    "the-agent": {
      "id": "the-agent",
      "mode": "alone"
    }
  },
  "scenario": {
    "file_name": "scenarios/misc/static_agent.yaml",
    "execution": {
      "tests": [
        {
          "program": "ls -al",
          "class": "shell",
          "title": "List all files"
        },
        {
          "title": "Run sample script",
          "class": "shell",
          "script": "#!/bin/bash\necho \"hello\"\necho \"world\"\n"
        }
      ]
    },
    "description": "This scenario runs tests on pre-deployed static agents",
    "deployment": {
      "agents": [
        {
          "id": "the-agent",
          "mode": "alone"
        }
      ]
    }
  }
}
  </script>

  <script type="text/javascript">
    "use strict";

    var fields = ["scenario", "test", "concurrency", "node", "agent_id"];

    function initSingleSelector(name, values) {
      var selectorId = "#" + name + "_selector";

      var options = [];
      for (var key in values) {
        options.push({id: key, text: key});
      }
      options.sort(function(x, y) {return (x > y)? -1: (x == y)? 0: 1});

      $(selectorId).
          select2({
            data: options,
            allowClear: true
          }).
          select2("enable", true).
          on("change", function (e) {
            update();
{#            window.location.search = "btn=" + e.val;#}
          });
    }

    function updateSelectors() {
      var records = report.records;

      $.each(fields, function(i, field) {
        var values = {};

        $.each(records, function(j, record) {
          values[record[field]] = true;
        });

        initSingleSelector(field, values);
      });
    }

    function update() {
      updateSelectors();

      var state = {};
      $.each(fields, function(i, field) {

      });
    }

    $(document).ready(function () {
      update();

      var app = $.sammy('#main', function () {

        this.get('#/', function (context) {
          context.log('Yo yo yo');
        });

        this.get('#/btn=:id', function (context) {
          context.log('hello' + this.params['id']);
        });

      });

      $(function () {
        app.run('#/');
      });

      // make table out of template!
      var source = $("#some-template").html();
      var template = Handlebars.compile(source);
      var agents_list = [];
      for (var agent_id in report.agents) {
        agents_list.push(report.agents[agent_id]);
      }
      $("#container").append(template({agents: agents_list, table_id: "agents_table"}));
      $("#agents_table").dataTable({
        "autoWidth": true,
        "paging": false,
        "ordering": false,
        "info": false
      });
    });

    $(function () {
      c3.generate({
        bindto: '#chart',
        data: {
          x: 'x',
          columns: [
            ['x', 1, 2, 3],
            ['y', 100, 75, 120]
          ],
          types: {y: 'area'}
        },
        axis: {
          x: {label: '# threads'},
          y: {label: 'Bandwidth, Mbits/s', min: 0}
        }
      });

      $("#the_table").dataTable({
        "autoWidth": true,
        "paging": false,
        "ordering": false,
        "info": false
      });

      $('[data-toggle="tooltip"]').tooltip();
    });
  </script>

  <style type="text/css">
  </style>

</head>

<body>

<div class="container" id="container">
  <div class="row text-center">
    <h1>Shaker | The Report</h1>
  </div>
  <hr>
  <div class="row">
    <div class="col-md-2">
      <label for="scenario_selector" title="Scenario name">Scenario</label>
      <input type="hidden" id="scenario_selector" class="form-control"
             data-placeholder="Select scenario"/>
    </div>
    <div class="col-md-2">
      <label for="test_selector" title="Test name">Test Case</label>
      <input type="hidden" id="test_selector" class="form-control"
             data-placeholder="Select test case"/>
    </div>
    <div class="col-md-2">
      <label for="concurrency_selector" title="Concurrency">Concurrency</label>
      <input type="hidden" id="concurrency_selector" class="form-control"
             data-placeholder="Select concurrency"/>
    </div>
    <div class="col-md-2">
      <label for="node_selector" title="Compute node">Compute Node</label>
      <input type="hidden" id="node_selector" class="form-control"
             data-placeholder="Select node"/>
    </div>
    <div class="col-md-2">
      <label for="agent_id_selector" title="Agent id">Agent</label>
      <input type="hidden" id="agent_id_selector" class="form-control"
             data-placeholder="Select agent"/>
    </div>
  </div>
  <h2>Title</h2>

  <img src="http://placehold.it/150X150" class="img-rounded img-responsive"
       alt=""> <span class="label label-success">success</span>
  <pre>inline code</pre>

  <div
      class="panel panel-default">
    <div class="panel-heading">Title</div>
    <div class="panel-body">Content here..</div>
  </div>

  <div class="row">
    <div id="chart"></div>
  </div>

  <table class="table table-striped" id="the_table">
    <thead>
    <tr>
      <th>Col 1</th>
      <th>Col 2</th>
      <th>Col 3</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>..</td>
      <td>..</td>
      <td>..</td>
    </tr>
    </tbody>
  </table>
</div>

<script id="some-template" type="text/x-handlebars-template">
  <table class="table table-striped" id="{{ table_id }}">
    <thead>
    <tr>
      <th>Agent</th>
      <th>Mode</th>
      <th>IP</th>
      <th>Node</th>
      <th>Instance Name</th>
    </tr>
    </thead>
    <tbody>
    {{#agents}}
    <tr>
      <td>{{ id }}</td>
      <td>{{ mode }}</td>
      <td>{{ ip }}</td>
      <td>{{ node }}</td>
      <td>{{ instance_name }}</td>
    </tr>
    {{/agents}}
    </tbody>
  </table>
</script>

</body>
</html>